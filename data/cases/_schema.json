{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "醫案結構定義",
  "description": "中醫醫案（病例）的標準化記錄格式",
  "type": "object",
  "required": ["id", "patient_info", "diagnosis", "treatment"],
  "properties": {
    "id": {
      "type": "string",
      "description": "唯一識別碼（case_ 前綴 + 編號）"
    },
    "source": {
      "type": "object",
      "properties": {
        "book": { "type": "string", "description": "來源書籍" },
        "author": { "type": "string", "description": "醫家" },
        "dynasty": { "type": "string", "description": "朝代" }
      },
      "description": "醫案來源（古籍醫案填寫）"
    },
    "patient_info": {
      "type": "object",
      "properties": {
        "gender": { "type": "string", "enum": ["男", "女"] },
        "age": { "type": "string", "description": "年齡或年齡段" },
        "occupation": { "type": "string", "description": "職業" },
        "constitution": { "type": "string", "description": "體質特點" }
      },
      "description": "患者基本信息"
    },
    "chief_complaint": {
      "type": "string",
      "description": "主訴"
    },
    "history": {
      "type": "object",
      "properties": {
        "present_illness": { "type": "string", "description": "現病史" },
        "past_history": { "type": "string", "description": "既往史" }
      },
      "description": "病史"
    },
    "examination": {
      "type": "object",
      "properties": {
        "inspection": { "type": "string", "description": "望診" },
        "auscultation": { "type": "string", "description": "聞診" },
        "inquiry": { "type": "string", "description": "問診" },
        "palpation": { "type": "string", "description": "切診" }
      },
      "description": "四診信息"
    },
    "symptoms_collected": {
      "type": "array",
      "items": { "type": "string" },
      "description": "收集的症狀 ID 列表"
    },
    "diagnosis": {
      "type": "object",
      "properties": {
        "disease_id": { "type": "string", "description": "疾病 ID" },
        "zhengxing_id": { "type": "string", "description": "證型 ID" },
        "zhengsu_analysis": {
          "type": "array",
          "items": { "type": "string" },
          "description": "證素分析 ID 列表"
        }
      },
      "required": ["zhengxing_id"],
      "description": "診斷"
    },
    "treatment": {
      "type": "object",
      "properties": {
        "principle": { "type": "array", "items": { "type": "string" }, "description": "治則" },
        "formula_id": { "type": "string", "description": "方劑 ID" },
        "formula_modification": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "action": { "type": "string", "enum": ["加", "減", "改量"] },
              "herb": { "type": "string" },
              "reason": { "type": "string" }
            }
          },
          "description": "方劑加減"
        },
        "prescription": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "herb_id": { "type": "string" },
              "herb_name": { "type": "string" },
              "amount": { "type": "string" }
            }
          },
          "description": "具體處方"
        },
        "administration": { "type": "string", "description": "服法" }
      },
      "required": ["principle"],
      "description": "治療"
    },
    "follow_up": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "date": { "type": "string", "description": "複診日期或第幾診" },
          "progress": { "type": "string", "description": "病情變化" },
          "adjustment": { "type": "string", "description": "處方調整" }
        }
      },
      "description": "隨診記錄"
    },
    "outcome": {
      "type": "string",
      "description": "療效結果"
    },
    "notes": {
      "type": "string",
      "description": "按語或醫案評析"
    }
  }
}
